<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Command Prompt</title>
    <style>
        /* Windows CMD Look & Feel */
        body {
            background-color: #0c0c0c; /* Bijna zwart */
            color: #cccccc; /* Lichtgrijs (standaard Windows CMD kleur) */
            font-family: Consolas, "Lucida Console", monospace;
            font-size: 16px;
            margin: 0;
            padding: 10px;
            overflow-y: scroll;
        }

        /* Container voor alle voorgaande commando's */
        #output-area {
            white-space: pre-wrap; /* Zorgt dat enters en spaties behouden blijven */
            word-wrap: break-word;
        }

        /* De input regel onderaan */
        .input-line {
            display: flex;
            margin-top: 5px;
        }

        .prompt {
            margin-right: 8px;
            user-select: none; /* Zodat je de prompt niet per ongeluk selecteert */
        }

        /* Het invoerveld onzichtbaar maken zodat het lijkt alsof je direct typt */
        input[type="text"] {
            background: transparent;
            border: none;
            color: inherit;
            font-family: inherit;
            font-size: inherit;
            flex-grow: 1;
            outline: none;
            padding: 0;
            margin: 0;
        }

        /* Foutmeldingen iets anders kleuren (optioneel) */
        .error {
            color: #e74c3c;
        }
    </style>
</head>
<body>

<div id="output-area">
    Microsoft Windows flag2{HouthavensAdmin1}<br>
    (c) Microsoft Corporation. All rights reserved.<br><br>
</div>

<div class="input-line">
    <span class="prompt">C:\Windows\System32></span>
    <input type="text" id="cmd-input" autocomplete="off" autofocus>
</div>

<script>
    const inputField = document.getElementById('cmd-input');
    const outputArea = document.getElementById('output-area');
    const body = document.body;
    // Pak de prompt span zodat we de tekst kunnen aanpassen
    const promptSpan = document.querySelector('.prompt');

    // Zet initiÃ«le prompt (optioneel, wordt overschreven na eerste commando)
    let currentPrompt = "C:\\Windows\\System32>";
    promptSpan.textContent = currentPrompt;

    document.addEventListener('click', () => inputField.focus());

    inputField.addEventListener('keydown', async (e) => {
        if (e.key === 'Enter') {
            const command = inputField.value;

            // 1. Toon het commando in de geschiedenis
            outputArea.innerHTML += `<div>${currentPrompt} ${escapeHtml(command)}</div>`;

            inputField.value = '';
            window.scrollTo(0, body.scrollHeight);

            if (!command.trim()) return;

            try {
                const response = await fetch('/cmd', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ command: command })
                });

                // 2. We verwachten nu JSON terug
                const data = await response.json();

                // Toon de output (als die er is)
                if (data.output) {
                    // Strip <pre> tags als die er nog in zitten
                    let cleanOutput = data.output.replace(/<\/?pre>/g, '');
                    outputArea.innerHTML += `<div>${escapeHtml(cleanOutput)}</div>`;
                }

                // 3. UPDATE DE PROMPT LIVE!
                if (data.cwd) {
                    currentPrompt = data.cwd + ">";
                    promptSpan.textContent = currentPrompt;
                }

            } catch (err) {
                outputArea.innerHTML += `<div class="error">Error: ${err.message}</div>`;
            }

            window.scrollTo(0, body.scrollHeight);
        }
    });

    function escapeHtml(text) {
        if (!text) return "";
        return text
            .replace(/&/g, "&amp;")
            .replace(/</g, "&lt;")
            .replace(/>/g, "&gt;")
            .replace(/"/g, "&quot;")
            .replace(/'/g, "&#039;")

            .replace(/\n/g, "<br>");
    }
</script>
</body>
</html>